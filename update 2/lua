local startTime = tick()

-- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫
local Library, SaveManager, InterfaceManager, le

local loadTasks = {
    function() Library = loadstring(game:HttpGet("https://github.com/ActualMasterOogway/Fluent-Renewed/releases/latest/download/Fluent.luau"))() end,
    function() SaveManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/ActualMasterOogway/Fluent-Renewed/master/Addons/SaveManager.luau"))() end,
    function() InterfaceManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/ActualMasterOogway/Fluent-Renewed/master/Addons/InterfaceManager.luau"))() end,
    function() le = loadstring(game:HttpGet('https://raw.githubusercontent.com/zawerex/Conexion1/refs/heads/main/conexion1'))() end
}

-- –ó–∞–ø—É—Å–∫–∞–µ–º –≤—Å–µ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
for _, task in ipairs(loadTasks) do
    task()
end

-- Services
local Players, RunService, Workspace, UIS, TweenService = game:GetService("Players"), game:GetService("RunService"), game:GetService("Workspace"), game:GetService("UserInputService"), game:GetService("TweenService")
local LocalPlayer = Players.LocalPlayer

-- –û–ø—Ä–µ–¥–µ–ª—è–µ–º –º–æ–±–∏–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ (—Ç–æ–ª—å–∫–æ Phone –∏ PC)
local IS_MOBILE = (UIS.TouchEnabled and not UIS.KeyboardEnabled)
local IS_DESKTOP = (UIS.KeyboardEnabled and not UIS.TouchEnabled)

-- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–π –∫–Ω–æ–ø–∫–∏
local mobileToggleButton, mobileToggleGui, isMobileInterfaceVisible = nil, nil, false

-- –ë—ã—Å—Ç—Ä–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
local limbs, espObjects, currentTargets, teleportedObjects, autoFarmProcessedObjects = {}, {}, {}, {}, {}
local connections = { esp = nil, autoCollect = nil, autoFarm = nil }
local lastTeleportTime, noclipConnection, flyConnection, bodyVelocity = 0

-- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
local ESP_ENABLED = false
local AUTO_COLLECT_ENABLED = false
local AUTO_TELEPORT_ENABLED = false
local AUTO_FIRE = false
local AUTO_FARM_ENABLED = false
local NOCLIP_ENABLED = false
local FLY_ENABLED = false
local WALKSPEED_ENABLED = false
local JUMPPOWER_ENABLED = false
local autoFarmIsActive = true

local SCAN_RADIUS = 30
local TELEPORT_COOLDOWN = 0.6
local currentFlySpeed = 50
local currentWalkSpeed = 16
local currentJumpPower = 50
local defaultWalkSpeed = 16
local defaultJumpPower = 50
local AUTO_FARM_RETURN_DELAY = 1
local AUTO_FARM_TELEPORT_DELAY = 0.3
local AUTO_FARM_CHECK_INTERVAL = 2

local flyKeys = { W = false, A = false, S = false, D = false, Up = false, Down = false }

-- –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–π –∫–Ω–æ–ø–∫–∏
local function createMobileToggleButton()
    if mobileToggleGui then mobileToggleGui:Destroy() end
    
    mobileToggleGui = Instance.new("ScreenGui")
    mobileToggleGui.Name = "NexusMobileToggle"
    mobileToggleGui.ResetOnSpawn = false
    mobileToggleGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    mobileToggleGui.Parent = game:GetService("CoreGui")
    
    -- –û—Å–Ω–æ–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞ —Å –±—É–∫–≤–æ–π N
    mobileToggleButton = Instance.new("TextButton")
    mobileToggleButton.Name = "MobileToggleButton"
    mobileToggleButton.Size = UDim2.new(0, 60, 0, 60)
    mobileToggleButton.Position = UDim2.new(1, -70, 0.5, -30)
    mobileToggleButton.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    mobileToggleButton.Text = "N"
    mobileToggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    mobileToggleButton.Font = Enum.Font.GothamBlack
    mobileToggleButton.TextSize = 32
    mobileToggleButton.TextStrokeTransparency = 0
    mobileToggleButton.TextStrokeColor3 = Color3.fromRGB(255, 255, 255)
    mobileToggleButton.ZIndex = 100
    mobileToggleButton.Parent = mobileToggleGui
    
    -- –°–∫—Ä—É–≥–ª–µ–Ω–Ω—ã–µ —É–≥–ª—ã
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 24)
    corner.Parent = mobileToggleButton
    
    -- –ë–µ–ª–∞—è –æ–±–≤–æ–¥–∫–∞
    local stroke = Instance.new("UIStroke")
    stroke.Color = Color3.fromRGB(255, 255, 255)
    stroke.Thickness = 1
    stroke.Parent = mobileToggleButton
    
    -- –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏
    mobileToggleButton.MouseButton1Down:Connect(function()
        if mobileToggleButton then
            local tweenInfo = TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
            local tween = TweenService:Create(mobileToggleButton, tweenInfo, {
                Size = UDim2.new(0, 55, 0, 55),
                BackgroundColor3 = Color3.fromRGB(20, 20, 20)
            })
            tween:Play()
        end
    end)
    
    mobileToggleButton.MouseButton1Up:Connect(function()
        if mobileToggleButton then
            local tweenInfo = TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
            local tween = TweenService:Create(mobileToggleButton, tweenInfo, {
                Size = UDim2.new(0, 60, 0, 60),
                BackgroundColor3 = Color3.fromRGB(0, 0, 0)
            })
            tween:Play()
        end
    end)
    
    -- –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
    mobileToggleButton.MouseButton1Click:Connect(function()
        toggleMobileInterface()
    end)
    
    return mobileToggleButton
end

local function toggleMobileInterface()
    if not Library or not Library.Window then return end
    
    isMobileInterfaceVisible = not isMobileInterfaceVisible
    Library.Window.Enabled = isMobileInterfaceVisible
    
    -- –û–±–Ω–æ–≤–ª—è–µ–º –≤–Ω–µ—à–Ω–∏–π –≤–∏–¥ –∫–Ω–æ–ø–∫–∏
    if mobileToggleButton then
        if isMobileInterfaceVisible then
            mobileToggleButton.Text = "N"
            mobileToggleButton.TextColor3 = Color3.fromRGB(255, 50, 50)
            mobileToggleButton.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
        else
            mobileToggleButton.Text = "N"
            mobileToggleButton.TextColor3 = Color3.fromRGB(255, 255, 0)
            mobileToggleButton.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
        end
    end
    
    -- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    Library:Notify({
        Title = "Nexus Mobile",
        Content = "Interface " .. (isMobileInterfaceVisible and "opened" or "closed"),
        Duration = 2
    })
end

local function initializeMobileInterface()
    if not IS_MOBILE then return end
    
    createMobileToggleButton()
    
    -- –°–∫—Ä—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
    if Library and Library.Window then
        Library.Window.Enabled = false
        isMobileInterfaceVisible = false
    end
    
    Library:Notify({
        Title = "Nexus Mobile",
        Content = "Tap the N button to open interface",
        Duration = 5
    })
end

-- ESP Folder (—Å–æ–∑–¥–∞–µ–º —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
local espFolder
local function getESPFolder()
    if not espFolder then
        espFolder = workspace:FindFirstChild("TargetESP") or Instance.new("Folder")
        espFolder.Name = "TargetESP"
        if not espFolder.Parent then
            espFolder.Parent = workspace
        end
    end
    return espFolder
end

-- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ utility functions
local function updateLimbsList()
    local character = LocalPlayer.Character
    if not character then return end
    
    limbs = {}
    for _, child in ipairs(character:GetChildren()) do
        if child:IsA("BasePart") then 
            limbs[#limbs + 1] = child.Name 
        end
    end
    table.sort(limbs)
end

local function teleportToTarget(targetObject)
    local character = LocalPlayer.Character
    if not character then return false end
    
    local hrp = character:FindFirstChild("HumanoidRootPart")
    if not hrp then return false end
    
    return pcall(function()
        hrp.CFrame = CFrame.new(targetObject.Position + Vector3.new(0, 3, 0))
        Workspace.CurrentCamera.CFrame = hrp.CFrame
        return true
    end)
end

local targetCache = {objects = {}, lastUpdate = 0}
local function findAllTargetPrompts()
    local currentTime = tick()
    -- –ö—ç—à–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞ 0.5 —Å–µ–∫—É–Ω–¥—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
    if currentTime - targetCache.lastUpdate < 0.5 and #targetCache.objects > 0 then
        return targetCache.objects
    end
    
    local targets = {}
    for _, obj in ipairs(Workspace:GetChildren()) do
        if obj.Name == "" then
            local promptAttachment = obj:FindFirstChild("PromptAttachment")
            if promptAttachment then
                local prompt = promptAttachment:FindFirstChild("ProximityPrompt")
                if prompt and prompt:IsA("ProximityPrompt") then
                    targets[#targets + 1] = {prompt = prompt, object = obj}
                end
            end
        end
    end
    
    targetCache.objects = targets
    targetCache.lastUpdate = currentTime
    return targets
end

local function fireProximity(prompt)
    if prompt and prompt:IsA("ProximityPrompt") and prompt.Enabled then
        return pcall(function() 
            local originalHoldDuration = prompt.HoldDuration
            prompt.HoldDuration = 0 
            fireproximityprompt(prompt)
            prompt.HoldDuration = originalHoldDuration
        end)
    end
    return false
end

local function teleportToPosition(position)
    local character = LocalPlayer.Character
    if not character then return false end
    
    local hrp = character:FindFirstChild("HumanoidRootPart")
    if not hrp then return false end
    
    return pcall(function()
        hrp.CFrame = CFrame.new(position)
        Workspace.CurrentCamera.CFrame = hrp.CFrame
    end)
end

-- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ ESP —Ñ—É–Ω–∫—Ü–∏–∏
local function createESP(targetObject)
    if not targetObject or espObjects[targetObject] then return false end
    
    local mainBillboard = Instance.new("BillboardGui")
    mainBillboard.Name = "ESPBillboard"
    mainBillboard.Size = UDim2.new(0, 250, 0, 60)
    mainBillboard.StudsOffset = Vector3.new(0, 4, 0)
    mainBillboard.AlwaysOnTop = true
    mainBillboard.Adornee = targetObject
    mainBillboard.Parent = getESPFolder()
    
    local container = Instance.new("Frame")
    container.Size = UDim2.new(1, 0, 1, 0)
    container.BackgroundTransparency = 1
    container.Parent = mainBillboard
    
    local uiListLayout = Instance.new("UIListLayout")
    uiListLayout.FillDirection = Enum.FillDirection.Horizontal
    uiListLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
    uiListLayout.VerticalAlignment = Enum.VerticalAlignment.Center
    uiListLayout.SortOrder = Enum.SortOrder.LayoutOrder
    uiListLayout.Padding = UDim.new(0, 5)
    uiListLayout.Parent = container
    
    local iconLabel = Instance.new("TextLabel")
    iconLabel.Name = "Icon"
    iconLabel.Size = UDim2.new(0, 40, 0, 40)
    iconLabel.BackgroundTransparency = 1
    iconLabel.TextColor3 = Color3.fromRGB(255, 0, 0)
    iconLabel.TextStrokeTransparency = 0.5
    iconLabel.TextStrokeColor3 = Color3.fromRGB(255, 255, 255)
    iconLabel.Font = Enum.Font.GothamBold
    iconLabel.TextSize = 30
    iconLabel.Text = "üéÉ"
    iconLabel.LayoutOrder = 1
    iconLabel.Parent = container
    
    local distanceLabel = Instance.new("TextLabel")
    distanceLabel.Name = "Distance"
    distanceLabel.Size = UDim2.new(0, 180, 0, 40)
    distanceLabel.BackgroundTransparency = 1
    distanceLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    distanceLabel.TextStrokeTransparency = 0
    distanceLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
    distanceLabel.Font = Enum.Font.GothamBold
    distanceLabel.TextSize = 16
    distanceLabel.Text = "Target: 0 studs"
    distanceLabel.TextXAlignment = Enum.TextXAlignment.Left
    distanceLabel.LayoutOrder = 2
    distanceLabel.Parent = container
    
    espObjects[targetObject] = {
        billboard = mainBillboard,
        distanceLabel = distanceLabel
    }
    return true
end

local function removeESPForObject(targetObject)
    if espObjects[targetObject] then
        espObjects[targetObject].billboard:Destroy()
        espObjects[targetObject] = nil
    end
end

local function removeAllESP()
    for targetObject, esp in pairs(espObjects) do
        if esp and esp.billboard then 
            esp.billboard:Destroy() 
        end
    end
    espObjects = {}
    currentTargets = {}
end

local function updateAllESPDistances()
    local character = LocalPlayer.Character
    if not character then return end
    
    local hrp = character:FindFirstChild("HumanoidRootPart") or character:FindFirstChild("UpperTorso") or character:FindFirstChild("Torso")
    if not hrp then return end
    
    local hrpPosition = hrp.Position
    for targetObject, esp in pairs(espObjects) do
        if targetObject and targetObject.Parent and esp and esp.distanceLabel then
            local distance = (targetObject.Position - hrpPosition).Magnitude
            esp.distanceLabel.Text = string.format("Distance: %.1f studs", distance)
        else
            removeESPForObject(targetObject)
        end
    end
end

local function createESPForAllObjects()
    if not ESP_ENABLED then return end
    local targets = findAllTargetPrompts()
    
    for _, targetData in ipairs(targets) do
        if not espObjects[targetData.object] then
            createESP(targetData.object)
        end
    end
    
    for targetObject, _ in pairs(espObjects) do
        local found = false
        for _, targetData in ipairs(targets) do
            if targetData.object == targetObject then 
                found = true 
                break 
            end
        end
        if not found then 
            removeESPForObject(targetObject) 
        end
    end
    
    currentTargets = targets
end

local function startESPLoop()
    if connections.esp then
        connections.esp:Disconnect()
    end
    
    connections.esp = RunService.Heartbeat:Connect(function()
        if ESP_ENABLED then 
            createESPForAllObjects() 
            updateAllESPDistances()
        else 
            if connections.esp then 
                connections.esp:Disconnect()
                connections.esp = nil
                removeAllESP() 
            end 
        end
    end)
end

-- Auto-teleport logic (–ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø)
local teleportedObjects = {} -- –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —É–∂–µ –ø–æ—Å–µ—â–µ–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤

local function performAutoTeleport()
    local currentTime = tick()
    -- –ü—Ä–æ–≤–µ—Ä—è–µ–º –ö–î –º–µ–∂–¥—É —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏—è–º–∏
    if currentTime - lastTeleportTime < TELEPORT_COOLDOWN then
        return false
    end
    
    local targets = findAllTargetPrompts()
    if #targets == 0 then 
        teleportedObjects = {} -- –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –∫–æ–≥–¥–∞ –æ–±—ä–µ–∫—Ç–æ–≤ –Ω–µ—Ç
        return false
    end
    
    -- –û—á–∏—â–∞–µ–º —Å–ø–∏—Å–æ–∫ –æ—Ç –æ–±—ä–µ–∫—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –±–æ–ª—å—à–µ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç
    for targetObject, _ in pairs(teleportedObjects) do
        if not targetObject or not targetObject.Parent then
            teleportedObjects[targetObject] = nil
        end
    end
    
    -- –°—á–∏—Ç–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    local totalObjects = #targets
    local visitedObjects = 0
    local newObjects = 0
    
    -- –ù–∞—Ö–æ–¥–∏–º –æ–±—ä–µ–∫—Ç—ã –∫ –∫–æ—Ç–æ—Ä—ã–º –µ—â–µ –Ω–µ —Ç–µ–ª–µ–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–ª–∏—Å—å
    local availableTargets = {}
    for _, targetData in ipairs(targets) do
        if teleportedObjects[targetData.object] then
            visitedObjects = visitedObjects + 1
        else
            newObjects = newObjects + 1
            table.insert(availableTargets, targetData)
        end
    end
    
    -- –ï—Å–ª–∏ –µ—Å—Ç—å –Ω–æ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã - —Ç–µ–ª–µ–ø–æ—Ä—Ç–∏—Ä—É–µ–º—Å—è –∫ –ø–µ—Ä–≤–æ–º—É
    if #availableTargets > 0 then
        local targetToTeleport = availableTargets[1].object
        local success = teleportToTarget(targetToTeleport)
        
        if success then
            -- –ü–æ–º–µ—á–∞–µ–º –æ–±—ä–µ–∫—Ç –∫–∞–∫ –ø–æ—Å–µ—â–µ–Ω–Ω—ã–π
            teleportedObjects[targetToTeleport] = true
            lastTeleportTime = currentTime
            print(string.format("–¢–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏—è –∫ –Ω–æ–≤–æ–º—É –æ–±—ä–µ–∫—Ç—É. –ü–æ—Å–µ—â–µ–Ω–æ: %d/%d", visitedObjects + 1, totalObjects))
            
            -- –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø—Ä–æ–º–ø—Ç –ø–æ—Å–ª–µ —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏–∏
            task.wait(0.3)
            local prompt = availableTargets[1].prompt
            if prompt and prompt.Enabled then
                fireProximity(prompt)
            end
            
            return true
        end
    else
        -- –í—Å–µ –æ–±—ä–µ–∫—Ç—ã —É–∂–µ –ø–æ—Å–µ—â–µ–Ω—ã - —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ü–∏–∫–ª–∞
        print(string.format("–í—Å–µ %d –æ–±—ä–µ–∫—Ç–æ–≤ —É–∂–µ –ø–æ—Å–µ—â–µ–Ω—ã. –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é...", totalObjects))
        teleportedObjects = {}
    end
    
    return false
end

-- –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø AutoCollect (—Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ)
local function startAutoCollect()
    if connections.autoCollect then
        connections.autoCollect:Disconnect()
        connections.autoCollect = nil
    end
    
    connections.autoCollect = RunService.Heartbeat:Connect(function()
        if not AUTO_COLLECT_ENABLED then 
            if connections.autoCollect then 
                connections.autoCollect:Disconnect()
                connections.autoCollect = nil
            end 
            return 
        end
        
        local character = LocalPlayer.Character
        if not character then return end
        
        local hrp = character:FindFirstChild("HumanoidRootPart") or character:FindFirstChild("UpperTorso") or character:FindFirstChild("Torso")
        if not hrp then return end
        
        local targets = findAllTargetPrompts()
        if #targets == 0 then 
            teleportedObjects = {} -- –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ü–µ–ª–µ–π
            return 
        end
        
        -- –ü–æ—Å—Ç–æ—è–Ω–Ω–æ –≤—ã–ø–æ–ª–Ω—è–µ–º —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏—é –ø–æ–∫–∞ –≤–∫–ª—é—á–µ–Ω AutoCollect
        if AUTO_TELEPORT_ENABLED then
            performAutoTeleport()
        end
        
        if AUTO_FIRE then
            local hrpPosition = hrp.Position
            for _, targetData in ipairs(targets) do
                local distance = (targetData.object.Position - hrpPosition).Magnitude
                if distance <= SCAN_RADIUS and targetData.prompt.Enabled then 
                    fireProximity(targetData.prompt) 
                end
            end
        end
    end)
end

-- FIXED Auto Farm functions with improved teleportation logic
local function returnToZero()
    local character = LocalPlayer.Character
    if not character then return false end
    
    local hrp = character:FindFirstChild("HumanoidRootPart")
    if not hrp then return false end
    
    return pcall(function()
        local humanoid = character:FindFirstChildOfClass("Humanoid")
        if humanoid then
            humanoid:ChangeState(Enum.HumanoidStateType.Flying)
        end
        
        local zeroPosition = Vector3.new(0, 500, 0)
        hrp.CFrame = CFrame.new(zeroPosition)
        Workspace.CurrentCamera.CFrame = hrp.CFrame
        
        return true
    end)
end

local function processAllAutoFarmObjects()
    if not autoFarmIsActive then return false end
    
    local targets = findAllTargetPrompts()
    if #targets == 0 then 
        -- –ï—Å–ª–∏ –æ–±—ä–µ–∫—Ç–æ–≤ –Ω–µ—Ç, –æ—á–∏—â–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é
        autoFarmProcessedObjects = {}
        return false
    end
    
    -- –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –≤–∞–ª–∏–¥–Ω—ã–µ —Ü–µ–ª–∏
    local validTargets = {}
    for _, targetData in ipairs(targets) do
        if targetData.object and targetData.object.Parent and targetData.prompt and targetData.prompt:IsA("ProximityPrompt") and targetData.prompt.Enabled then
            table.insert(validTargets, targetData)
        end
    end
    
    if #validTargets == 0 then
        -- –ï—Å–ª–∏ –Ω–µ—Ç –≤–∞–ª–∏–¥–Ω—ã—Ö —Ü–µ–ª–µ–π, –æ—á–∏—â–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é
        autoFarmProcessedObjects = {}
        return false
    end
    
    -- –û—á–∏—â–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –æ—Ç –æ–±—ä–µ–∫—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã—Ö –±–æ–ª—å—à–µ –Ω–µ—Ç –≤ Workspace
    for targetObject, _ in pairs(autoFarmProcessedObjects) do
        if not targetObject or not targetObject.Parent then
            autoFarmProcessedObjects[targetObject] = nil
        end
    end
    
    local character = LocalPlayer.Character
    if not character then return false end
    
    local processedInThisCycle = false
    
    -- –¢–µ–ª–µ–ø–æ—Ä—Ç–∏—Ä—É–µ–º—Å—è –∫–æ –≤—Å–µ–º –Ω–∞–π–¥–µ–Ω–Ω—ã–º –æ–±—ä–µ–∫—Ç–∞–º
    for _, targetData in ipairs(validTargets) do
        if not autoFarmIsActive then break end
        
        local targetToTeleport = targetData.object
        local prompt = targetData.prompt

        -- –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—ä–µ–∫—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å –∏ –≤—Å–µ –µ—â–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç
        if autoFarmProcessedObjects[targetToTeleport] then
            continue
        end

        local teleportSuccess = teleportToTarget(targetToTeleport)
        
        if teleportSuccess then
            processedInThisCycle = true
            
            -- –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø—Ä–æ–º–ø—Ç
            if prompt and prompt.Enabled then
                for i = 1, 3 do
                    fireProximity(prompt)
                    task.wait(0.3)
                end
            end
            
            -- –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–±—ä–µ–∫—Ç –≤—Å–µ –µ—â–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
            if targetToTeleport and targetToTeleport.Parent then
                autoFarmProcessedObjects[targetToTeleport] = true
            end
            
            task.wait(AUTO_FARM_TELEPORT_DELAY)
        end
    end
    
    -- –ü–æ—Å–ª–µ —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏–∏ –∫–æ –≤—Å–µ–º –æ–±—ä–µ–∫—Ç–∞–º –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ –Ω—É–ª–µ–≤—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
    if processedInThisCycle then
        task.wait(AUTO_FARM_RETURN_DELAY)
        returnToZero()
        return true
    end
    
    return false
end

local function startAutoFarmCycle()
    returnToZero()
    task.wait(2)
    
    while true do
        if not autoFarmIsActive then
            task.wait(1)
        else
            processAllAutoFarmObjects()
            task.wait(AUTO_FARM_CHECK_INTERVAL)
        end
    end
end

local function initializeAutoFarm()
    task.spawn(startAutoFarmCycle)
end
-- Movement functions - –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï
local function updateNoClip()
    if noclipConnection then
        noclipConnection:Disconnect()
        noclipConnection = nil
    end
    
    if NOCLIP_ENABLED then
        noclipConnection = RunService.Stepped:Connect(function()
            if NOCLIP_ENABLED then
                local character = LocalPlayer.Character
                if character then
                    for _, part in ipairs(character:GetDescendants()) do
                        if part:IsA("BasePart") then
                            part.CanCollide = false
                        end
                    end
                end
            end
        end)
    else
        local character = LocalPlayer.Character
        if character then
            for _, part in ipairs(character:GetDescendants()) do
                if part:IsA("BasePart") then
                    part.CanCollide = true
                end
            end
        end
    end
end

-- –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø —Ñ—É–Ω–∫—Ü–∏—è Fly (—É–±—Ä–∞–Ω–æ PlatformStand)
local function updateFly()
    if flyConnection then
        flyConnection:Disconnect()
        flyConnection = nil
    end
    
    if bodyVelocity then
        bodyVelocity:Destroy()
        bodyVelocity = nil
    end
    
    if FLY_ENABLED and LocalPlayer.Character then
        local root = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        if not root then return end
        
        bodyVelocity = Instance.new("BodyVelocity")
        bodyVelocity.Name = "FlyVelocity"
        bodyVelocity.MaxForce = Vector3.new(40000, 40000, 40000)
        bodyVelocity.Velocity = Vector3.zero
        bodyVelocity.Parent = root
        
        flyConnection = RunService.RenderStepped:Connect(function()
            if FLY_ENABLED and root and bodyVelocity then
                local cam = workspace.CurrentCamera
                local dir = Vector3.zero
                
                if flyKeys.W then dir = dir + cam.CFrame.LookVector end
                if flyKeys.S then dir = dir - cam.CFrame.LookVector end
                if flyKeys.A then dir = dir - cam.CFrame.RightVector end
                if flyKeys.D then dir = dir + cam.CFrame.RightVector end
                if flyKeys.Up then dir = dir + Vector3.new(0, 1, 0) end
                if flyKeys.Down then dir = dir - Vector3.new(0, 1, 0) end
                
                if dir.Magnitude > 0 then
                    bodyVelocity.Velocity = dir.Unit * currentFlySpeed
                else
                    bodyVelocity.Velocity = Vector3.zero
                end
            end
        end)
    else
        if bodyVelocity then
            bodyVelocity:Destroy()
            bodyVelocity = nil
        end
    end
end

-- –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï —Ñ—É–Ω–∫—Ü–∏–∏ WalkSpeed –∏ JumpPower
local function updateWalkSpeed()
    if LocalPlayer.Character then
        local humanoid = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
        if humanoid then
            if WALKSPEED_ENABLED then
                humanoid.WalkSpeed = currentWalkSpeed
            else
                humanoid.WalkSpeed = defaultWalkSpeed
            end
        end
    end
end

local function updateJumpPower()
    if LocalPlayer.Character then
        local humanoid = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
        if humanoid then
            if JUMPPOWER_ENABLED then
                humanoid.JumpPower = currentJumpPower
            else
                humanoid.JumpPower = defaultJumpPower
            end
        end
    end
end

-- Input handling
local function handleFlyInput(input, isBeginning)
    if not FLY_ENABLED then return end
    
    local key = input.KeyCode
    if key == Enum.KeyCode.W then flyKeys.W = isBeginning
    elseif key == Enum.KeyCode.A then flyKeys.A = isBeginning
    elseif key == Enum.KeyCode.S then flyKeys.S = isBeginning
    elseif key == Enum.KeyCode.D then flyKeys.D = isBeginning
    elseif key == Enum.KeyCode.Space then flyKeys.Up = isBeginning
    elseif key == Enum.KeyCode.LeftShift then flyKeys.Down = isBeginning end
end

UIS.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    handleFlyInput(input, true)
end)

UIS.InputEnded:Connect(function(input)
    handleFlyInput(input, false)
end)

-- –£—Å–∫–æ—Ä–µ–Ω–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è GUI
local function initializeGUI()
    if _G.NexusGUIInitialized then return end
    _G.NexusGUIInitialized = true
    
    -- –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–∞–∑–º–µ—Ä –æ–∫–Ω–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
    local windowSize = IS_MOBILE and UDim2.fromOffset(490, 250) or UDim2.fromOffset(500, 310)
    
    local Window = Library:CreateWindow({
        Title = "Nexus v1.0.0",
        SubTitle = "üçÅ",
        TabWidth = 100,
        Size = windowSize,
        Acrylic = false,
        Theme = "Dark",
        MinimizeKey = Enum.KeyCode.LeftAlt
    })

    local Tabs = {
        legit = Window:AddTab({ Title = "Legit", Icon = "github" }),
        farm = Window:AddTab({ Title = "Farm", Icon = "package" }),
        rage = Window:AddTab({ Title = "Rage", Icon = "venetian-mask" }),
        settings = Window:AddTab({ Title = "Settings", Icon = "settings" })
    }

    local Options = Library.Options

    -- Legit Tab
    Tabs.legit:CreateSection("Aim")
    
    local AimBotToggle = Tabs.legit:CreateToggle("AimBot", {
        Title = "AimBot [In Development]",
        Description = "Function in development",
        Default = false
    })
    
    AimBotToggle:OnChanged(function(Value)
        print("AimBot " .. (Value and "enabled (in development)" or "disabled"))
    end)

    Tabs.legit:CreateSection("Hitbox Expander")
    
    local HitboxToggle = Tabs.legit:CreateToggle("HitboxExpander", {
        Title = "Hitbox Expander",
        Default = false
    })
    
    HitboxToggle:OnChanged(function() 
        le.toggleState(Options.HitboxExpander.Value) 
    end)

    Tabs.legit:CreateSlider("HitboxSize", {
        Title = "Hitbox Size",
        Description = "Hitbox size (5-50)",
        Default = le.LIMB_SIZE or 10,
        Min = 5,
        Max = 50,
        Rounding = 1,
        Callback = function(value)
            le.LIMB_SIZE = value
            if Options.HitboxExpander.Value then 
                le.toggleState(false)
                le.toggleState(true)
            end
        end
    })

    Tabs.legit:CreateSlider("HitboxTransparency", {
        Title = "Hitbox Transparency",
        Description = "Hitbox transparency",
        Default = le.LIMB_TRANSPARENCY or 0.5,
        Min = 0,
        Max = 1,
        Rounding = 2,
        Callback = function(value)
            le.LIMB_TRANSPARENCY = value
            if Options.HitboxExpander.Value then 
                le.toggleState(false)
                le.toggleState(true)
            end
        end
    })

    local CollisionToggle = Tabs.legit:CreateToggle("LimbCollisions", {
        Title = "Limb Collisions",
        Default = le.LIMB_CAN_COLLIDE or false
    })
    
    CollisionToggle:OnChanged(function()
        le.LIMB_CAN_COLLIDE = Options.LimbCollisions.Value
        if Options.HitboxExpander.Value then 
            le.toggleState(false)
            le.toggleState(true)
        end
    end)

    local LimbDropdown = Tabs.legit:CreateDropdown("TargetLimb", {
        Title = "Target Limb",
        Description = "Select body part to expand",
        Values = limbs,
        Default = le.TARGET_LIMB or "HumanoidRootPart",
        Multi = false,
        Callback = function(value)
            le.TARGET_LIMB = value
            if Options.HitboxExpander.Value then 
                le.toggleState(false)
                le.toggleState(true)
            end
        end
    })

    if #limbs > 0 then
        Options.TargetLimb:SetValues(limbs)
        if not table.find(limbs, le.TARGET_LIMB) then
            le.TARGET_LIMB = "HumanoidRootPart"
            Options.TargetLimb:SetValue("HumanoidRootPart")
        end
    end

    -- Farm Tab
    Tabs.farm:CreateSection("Auto Farm")

    local AutoFarmToggle = Tabs.farm:CreateToggle("AutoFarm", {
        Title = "Auto Farm",
        Default = false
    })

    AutoFarmToggle:OnChanged(function()
        AUTO_FARM_ENABLED = Options.AutoFarm.Value
        autoFarmIsActive = Options.AutoFarm.Value
        
        if AUTO_FARM_ENABLED then
            initializeAutoFarm()
        else
            autoFarmProcessedObjects = {}
        end
    end)

    Tabs.farm:CreateSection("AutoCollect")
    
    local AutoCollectToggle = Tabs.farm:CreateToggle("AutoCollect", {
        Title = "AutoCollect",
        Default = false
    })
    
    AutoCollectToggle:OnChanged(function()
        AUTO_COLLECT_ENABLED = Options.AutoCollect.Value
        AUTO_TELEPORT_ENABLED = Options.AutoCollect.Value
        AUTO_FIRE = Options.AutoCollect.Value
        
        if AUTO_COLLECT_ENABLED then
            startAutoCollect()
        else
            teleportedObjects = {}
        end
    end)

    local EspChestsToggle = Tabs.farm:CreateToggle("EspChests", {
        Title = "Esp Chests",
        Default = false
    })
    
    EspChestsToggle:OnChanged(function()
        ESP_ENABLED = Options.EspChests.Value
        
        if ESP_ENABLED then
            createESPForAllObjects()
            startESPLoop()
        else
            removeAllESP()
        end
    end)

    -- –ü–ï–†–ï–ù–ï–°–ï–ù–ù–ê–Ø –°–ï–ö–¶–ò–Ø –≤ Farm Tab
    Tabs.farm:CreateSection("Teleport to the Infinity Stones")

    local GemTeleportDropdown = Tabs.farm:CreateDropdown("TeleportToGems", {
        Title = "Teleport to gems",
        Values = {"Time Stone", "Power Stone", "Darkhold"},
        Multi = false,
        Default = nil,
    })

    local isFirstSelection = true

    GemTeleportDropdown:OnChanged(function(Value)
        if isFirstSelection then
            isFirstSelection = false
            return
        end
        
        local position
        
        if Value == "Time Stone" then
            position = Vector3.new(2381.15, 686.16, 659.72)
        elseif Value == "Power Stone" then
            position = Vector3.new(-344.59, 697.17, 1901.58)
        elseif Value == "Darkhold" then
            position = Vector3.new(-2818.04, 1050.64, 648.63)
        end
        
        if position then
            teleportToPosition(position)
        end
    end)

    -- Rage Tab
    Tabs.rage:CreateSection("Movement")
    
    local NoClipToggle = Tabs.rage:CreateToggle("NoClip", {
        Title = "NoClip",
        Description = "Disables collision with objects",
        Default = false
    })
    
    NoClipToggle:OnChanged(function(Value)
        NOCLIP_ENABLED = Value
        updateNoClip()
    end)

    local FlyToggle = Tabs.rage:CreateToggle("Fly", {
        Title = "Fly",
        Description = "Allows flying in any direction",
        Default = false
    })
    
    FlyToggle:OnChanged(function(Value)
        FLY_ENABLED = Value
        updateFly()
    end)

    local WalkSpeedToggle = Tabs.rage:CreateToggle("WalkSpeed", {
        Title = "Walk Speed",
        Description = "Changes character movement speed",
        Default = false
    })
    
    WalkSpeedToggle:OnChanged(function(Value)
        WALKSPEED_ENABLED = Value
        updateWalkSpeed()
    end)

    local JumpPowerToggle = Tabs.rage:CreateToggle("JumpPower", {
        Title = "Jump Power",
        Description = "Changes character jump power",
        Default = false
    })
    
    JumpPowerToggle:OnChanged(function(Value)
        JUMPPOWER_ENABLED = Value
        updateJumpPower()
    end)

    Tabs.rage:CreateSection("Setting up functions")

    Tabs.rage:CreateSlider("FlySpeed", {
        Title = "Fly Speed",
        Description = "Fly speed (1-200)",
        Default = 50,
        Min = 1,
        Max = 200,
        Rounding = 1,
        Callback = function(value)
            currentFlySpeed = value
        end
    })
    
    Tabs.rage:CreateSlider("WalkSpeedValue", {
        Title = "Walk Speed Value",
        Description = "Movement speed (0-100)",
        Default = 16,
        Min = 0,
        Max = 100,
        Rounding = 1,
        Callback = function(value)
            currentWalkSpeed = value
            if WALKSPEED_ENABLED then
                updateWalkSpeed()
            end
        end
    })

    Tabs.rage:CreateSlider("JumpPowerValue", {
        Title = "Jump Power Value",
        Description = "Jump power (1-10000)",
        Default = 50,
        Min = 1,
        Max = 10000,
        Rounding = 1,
        Callback = function(value)
            currentJumpPower = value
            if JUMPPOWER_ENABLED then
                updateJumpPower()
            end
        end
    })

    SaveManager:SetLibrary(Library)
    InterfaceManager:SetLibrary(Library)
    SaveManager:IgnoreThemeSettings()
    SaveManager:SetIgnoreIndexes({})
    InterfaceManager:SetFolder("FluentScriptHub")
    SaveManager:SetFolder("FluentScriptHub/specific-game")
    InterfaceManager:BuildInterfaceSection(Tabs.settings)
    SaveManager:BuildConfigSection(Tabs.settings)

    Window:SelectTab(1)
    SaveManager:LoadAutoloadConfig()
    
    local loadTime = tick() - startTime
    
    -- –†–∞–∑–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –ü–ö –∏ –º–æ–±–∏–ª—å–Ω—ã—Ö
    if IS_MOBILE then
        Library:Notify({
            Title = "Nexus Mobile",
            Content = "Interface loaded! Tap the N button to open.",
            Duration = 5
        })
    else
        Library:Notify({
            Title = "Nexus",
            Content = "Interface loaded successfully! (" .. string.format("%.2f", loadTime) .. "s)",
            SubContent = "Press LeftAlt to hide/show interface",
            Duration = 5
        })
    end
    
    -- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –º–æ–±–∏–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
    if IS_MOBILE then
        initializeMobileInterface()
    end
end

-- –£—Å–∫–æ—Ä–µ–Ω–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø
local function fullInitialization()
    if _G.NexusGUIInitialized then return end
    
    -- –ë—ã—Å—Ç—Ä–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ
    task.spawn(function()
        if LocalPlayer.Character then
            updateLimbsList()
        end
        
        local characterConnection
        characterConnection = LocalPlayer.CharacterAdded:Connect(function(character)
            task.wait(1)
            updateLimbsList()
            teleportedObjects = {}
            autoFarmProcessedObjects = {}
            
            -- –£–±—Ä–∞–Ω—ã —Å–±—Ä–æ—Å—ã WALKSPEED_ENABLED –∏ JUMPPOWER_ENABLED
            NOCLIP_ENABLED = false
            FLY_ENABLED = false
            
            updateNoClip()
            updateFly()
            
            -- –û–±–Ω–æ–≤–ª—è–µ–º WalkSpeed –∏ JumpPower —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω–∏ –≤–∫–ª—é—á–µ–Ω—ã
            if WALKSPEED_ENABLED then
                updateWalkSpeed()
            end
            if JUMPPOWER_ENABLED then
                updateJumpPower()
            end
            
            if AUTO_FARM_ENABLED then
                task.wait(2)
                returnToZero()
            end
        end)
        
        initializeGUI()
        
        print("Nexus Loaded - Ready to use")
        if IS_MOBILE then
            print("Mobile interface with N button activated")
        else
            print("PC interface activated")
        end
    end)
end

-- –ó–∞–ø—É—Å–∫
fullInitialization()
